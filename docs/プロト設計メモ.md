# 🎂 Birthday Voucher（プロト設計メモ・軽量版）

## 1. 概要

夫への誕生日プレゼントとして「1万円分のお買い物券」をWebアプリとして発行・管理する。  
利用者は夫、管理者は妻。夫が購入内容を登録すると残高が減算され、履歴に反映される。  
有効期限は誕生日から1年間。来年以降も再発行して継続利用可能。

---

## 2. 画面構成

### 👩 妻（管理画面）
- 残高設定・更新（お買い物券の発行）
- 残高確認
- 登録履歴の閲覧・削除
- 有効期限の設定

### 👨 夫（利用画面）
- 残高表示（現在残高をリアルタイム取得）
- 購入内容の登録（品名・金額・日付・メモ）
- 購入履歴の一覧表示（新しい順）
- 有効期限切れ時は登録ボタンを無効化

---

## 3. Firestore 構成（共通コレクション＋年度フィールド）

### 📁 コレクション構成
```
/settings/{id}
/purchases/{id}
```

### 📘 settings ドキュメント
| フィールド | 型 | 説明 |
|-------------|----|------|
| `year` | number | 対象年度 |
| `balance` | number | 現在残高（円単位） |
| `limitDate` | string | 有効期限（日付文字列） |
| `createdAt` | timestamp | 発行日時 |

### 🛒 purchases ドキュメント
| フィールド | 型 | 説明 |
|-------------|----|------|
| `item` | string | 購入品名 |
| `price` | number | 購入金額（整数） |
| `date` | string | 購入日（ISO形式） |
| `note` | string | メモ（任意） |
| `year` | number | 年度 |
| `createdAt` | timestamp | 登録日時 |

---

## 4. データフロー

1. 妻が `/settings` に残高・有効期限を登録（例：balance=10000, year=2025）  
2. 夫が `/purchases` に購入内容を登録  
3. 登録トリガーで以下の処理を行う：
   - `balance` を `price` 分だけ減算  
   - 残高が 0 以下なら登録不可または警告表示  
4. 残高情報をリアルタイムで画面に反映  
5. 有効期限 (`limitDate`) を超えた場合、登録フォームを無効化

---

## 5. PWA / セキュリティ概要

### 🔒 Firebase Authentication
- 妻アカウントのみログイン可能  
- Firestore Security Rules（例）：
  ```js
  rules_version = '2';
  service cloud.firestore {
    match /databases/{database}/documents {
      match /{document=**} {
        allow read, write: if request.auth.uid == "（妻のUID）";
      }
    }
  }
  ```

### ⚙️ PWA構成
- Manifest.json 設定（アプリアイコン・名前・起動URL）
- Service Worker で主要ページをキャッシュ  
- オフライン時は直近の残高と履歴をローカルに保持

---

## 6. 今後の拡張メモ
- 🔔 残高0円時に通知（LINE API連携）  
- 🗓️ 年度切替時に自動リセットボタン追加  
- 💾 Firestoreデータのバックアップボタン  
- 📊 使用履歴グラフの追加（Recharts などで可視化）
