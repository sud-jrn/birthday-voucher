# 🎂 Birthday Voucher（夫用お誕生日お買い物アプリ）

## 💡 概要
このアプリは、夫の誕生日プレゼントとして「1万円分のお買い物券」を発行できるWebアプリです。  
買ったものを登録すると残高が減り、履歴を振り返ることもできます。  
誕生日らしいデザインで、楽しく記録できる小さな「お祝いアプリ」です🎁

---

## ✨ 主な機能

### 🎉 ユーザー（夫）用
| 機能 | 内容 |
|------|------|
| 🎂 トップ画面 | 「Happy Birthday ○○！」のメッセージ表示 |
| 💰 残高表示 | 初期残高1万円／購入に応じて減算 |
| 📅 有効期限管理 | 発行日から1年間有効 |
| 🛍️ 買い物登録 | 日付・内容・金額を登録可能 |
| ✏️ 編集・削除 | 登録済みデータの修正や削除が可能 |
| 📱 PWA対応 | ホーム画面に追加してアプリ風に使える |

---

### 💐 管理者（妻）用
| 機能 | 内容 |
|------|------|
| 💰 残高リセット | 新しい年度の買い物券を発行 |
| 🔐 アクセス制限 | 専用URLからのみアクセス可能（非公開運用） |

---

## 🧱 技術構成

| 項目 | 使用技術 |
|------|-----------|
| フロントエンド | HTML / CSS / JavaScript（Vue or Reactでも可） |
| データベース | Firebase Firestore |
| 認証 | Firebase Authentication（妻のみ） |
| デプロイ | Firebase Hosting |
| 対応端末 | Androidスマートフォン（PWA対応） |

---

## 🗂️ データ構造（Firebase）

| コレクション名 | フィールド | 型 | 説明 |
|----------------|------------|----|------|
| `purchases` | `item` | string | 買ったもの |
|  | `price` | number | 金額 |
|  | `date` | string | 日付 |
|  | `createdAt` | timestamp | 登録日時 |
| `settings` | `balance` | number | 現在の残高 |
|  | `issuedAt` | date | 発行日 |
|  | `expireAt` | date | 有効期限 |

---

## 🎨 画面構成（ワイヤーフレーム）

### 🏠 ホーム画面（夫用）

────────────────────────────  
🎂 Happy Birthday, ○○！（夫さんの名前）

💰 残高：10,000円  
📅 有効期限：2026/10/10まで

────────────────────────────  
🛒 買い物を登録する  
────────────────────────────  
[ 商品名 ]　　パン  
[ 金額 ]　　　500  
[ 日付 ]　　　2025/10/10  
　　　　　　［＋ 登録］  

────────────────────────────  
📋 買い物履歴  
────────────────────────────  
🍞 パン　500円　2025/10/10　［✏ 編集］［🗑 削除］  
👕 Tシャツ　3,000円　2025/10/11　［✏ 編集］［🗑 削除］  
────────────────────────────

💡 残り 6,500円 です！  
────────────────────────────

---

### 🎁 管理メニュー

────────────────────────────  
🎁 管理メニュー  
────────────────────────────  
💰 残高リセット（新しい買い物券を発行）

[ 新しい金額 ]　10000  
[ 発行日 ]　　　2025/10/10  
[ 有効期限 ]　　2026/10/10  
　　　　　　［発行］

---

### 🧩 PWA設定画面（初回アクセス時）
────────────────────────────  
🎂 Birthday Voucher 🎁

📱 ホーム画面に追加すると便利です！  

［＋ ホーム画面に追加］  
────────────────────────────


## 🔄 画面遷移図

```mermaid
graph TD
    A[🎂 ホーム画面（夫用）]
    B[⚙️ 管理画面（妻用）]
    C[📱 PWA追加画面]

    A --> B
    A --> C
    B --> A
---

## 💡 追加要件（非機能・運用系）

### 🧩 非機能要件

#### ■ パフォーマンス・動作環境
- 対象端末：Android スマートフォン（Chrome最新版）  
- 想定ユーザー：妻（管理者）・夫（利用者）の2名  
- 想定利用頻度：週1〜2回の記録・確認程度  
- PWA対応：  
　- インストール可能なWebアプリとして提供  
　- Service Workerで主要画面・Firestoreデータのキャッシュを保持（簡易オフライン閲覧を可能にする）  

#### ■ セキュリティ・認証
- Firebase Authentication を使用して妻のみログイン可能とする  
- Firestore Security Rules 例：
  ```js
  rules_version = '2';
  service cloud.firestore {
    match /databases/{database}/documents {
      match /{document=**} {
        allow read, write: if request.auth.uid == "（妻のUID）";
      }
    }
  }
  ```
- APIキー等の認証情報は .env で管理し、リポジトリには含めない  

#### ■ バックアップ・データ保全
- Firestoreのバックアップは自動では行われないため、定期的に手動エクスポートを実施  
- エクスポート対象：  
  - `settings`（残高情報）  
  - `purchases`（購入履歴）  
- エクスポート方法例：Firebase CLI  
  ```bash
  firebase firestore:export ./backup
  ```

---

### 🔄 運用・保守方針

#### ■ 年度更新
- 有効期限（誕生日から1年）が過ぎた場合の扱い：
  - 新しい年度の「お買い物券」を発行し直す
  - 過去データは `archive` コレクションに移動して保持  
    （例：`archive/{年度}/purchases`）
- 古い年度データを削除せず、参照専用で残す  

#### ■ データ仕様補足
| フィールド | 型 | 備考 |
|-------------|----|------|
| `price` | number | 小数不可。整数入力（円単位） |
| `date` | string (ISO形式) | Firestore Timestampでも可 |
| `note` | string | 任意メモ。最大50文字程度推奨 |
| `balance` | number | 自動計算で更新 |

---

### 🧭 利用シナリオ（想定フロー）
1. 妻がWebアプリを開き、「お買い物券を発行」ボタンから金額を設定（例：10,000円）  
2. 夫がアプリを開き、購入内容・金額を入力して登録  
3. 登録時に残高が自動で減算され、履歴に追加  
4. 有効期限切れ後は登録ボタンを無効化  
5. 新年度発行で残高・履歴がリセットされる  

---

### 💭 将来的な拡張メモ（検討項目）
- 🔔 残高が0円になったときの通知（LINE Messaging API連携）  
- 💬 メッセージ添付機能（「これ買ったよ」コメントを残す）  
- 💾 夫婦それぞれのアカウント連携（閲覧専用モード）  
- 📊 統計画面（カテゴリー別・月別の使用額グラフ）
